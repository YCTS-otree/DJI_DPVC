# DJI Video Preview Converter

本项目是一个用于将视频转换为 **大疆 (DJI) 设备可预览格式** 的小工具。  
无需破解，真正做到 **即拖即用**，完美适配校园等不允许携带手机又想刷视频的场景。  
提供了更友好的 UI 界面，让普通用户也能轻松完成视频格式转换。  

👉 适用场景：  
- 将视频转换为 DJI Action 相机、DJI Goggles 系列眼镜等设备可直接预览的格式  
- 自动匹配分辨率、码率、帧率  
- 支持 **x265 (HEVC)** 编码，并根据硬件环境自动调整 GPU 加速开关  

---

## ✨ 功能特色
- ✅ 一键式转换，免去繁琐的参数设置  
- ✅ CRF 算法支持 —— 输出更小的文件体积，画质仍然清晰  
- ✅ UI 友好，适合零基础用户
- ✅ 支持 **NVIDIA NVENC** 硬件加速，并在不支持时自动关闭  
- ✅ 自动检测并配置 **ffmpeg**  

---

## 📥 安装方法
你无需自行配置 `ffmpeg` 或环境变量。  

1. 前往 [Releases](../../releases) 页面，下载最新的 **完整安装包 (DJI_DPVC_vX.X_setup_.exe)**。  
2. 运行安装程序，工具会自动部署配置文件到系统推荐目录（AppData），解决写入权限问题。  
3. 启动后即可使用。  

---

## 🎬 使用教程  
👉 [安装与使用方法 - Bilibili](https://www.bilibili.com/video/BV1cCuYzvExf)  

---

## ⚠️ 注意事项
- 本仓库 **仅开源了核心实现代码**，不包含完整的二进制依赖与安装逻辑。  
- 如果你只想使用工具，请直接下载 Releases 里的安装包。  
- 如果你是开发者，可以在本仓库中查看核心实现代码，理解本工具的转换逻辑。  

---

## 📝 更新日志
### v4.0.0

#### 1) 初始特性与硬件加速支持
- 集成 GPU/硬件加速编码，新增 Intel® QSV 支持；编码启动按钮会显示当前使用的加速方式（NV / QSV / CPU）。
- 支持 HEVC NVENC 质量模式，并将质量策略映射为 CRF/CQ/VBR 参数；当设备不支持 HEVC NVENC 时自动回退到 CPU 编码。

#### 2) 配置与界面改进
- 将 NV/QSV 加速标志迁移至全局配置，增加配置版本号与自动修复逻辑，避免旧配置导致启动失败。
- 改进弹窗组件，支持可变按钮数量并提供更清晰的错误提示。
- 调整 FFmpeg 调用方式，默认隐藏控制台窗口；新增阶段性进度条与 ETA（剩余时间估计）显示。
- 引入“双重加速”策略：优先尝试 GPU（NV/QSV），失败后自动回退 CPU；并补充硬件利用率采样能力，优化进度与时间估算准确性。
- 新增尾帧水印能力；检测到输入码率较低时支持 HEVC 直写以减少不必要重编码带来的质量损失。
- 新增持久日志与错误转储能力，支持导出程序状态与环境变量用于排查问题。

#### 3) 错误处理与日志
- 扩展 FFmpeg 错误日志采集，记录完整输出并在错误转储中加入全局变量快照。
- 修复 NVENC HEVC 初始化相关问题，统一质量参数构建逻辑并替换过时设置项，提升编码稳定性。
- 重新调校 NVENC 质量模式，修复预览质量下降问题；质量优先模式下自动使用 CRF/CQ 参数。
- UI 中“码率”字段调整为“质量分数”，并强化质量优先编码策略。
- 在编码尝试循环中动态刷新启动按钮与回退提示，能够根据下一可用硬件路径给出更准确指引。

#### 4) 界面功能增强
- 新增主窗口最小化/还原支持，改善长时间编码时的桌面占用体验。
- 引入统一日志输出格式；在未检测到 FFmpeg 或运行失败时，支持自动下载并修复 ffmpeg/ffprobe。
- 增加 FFmpeg 下载进度弹窗（含速度与进度）；自动修复失败时提供手动下载回退引导。
- 将 FFmpeg 工作目录迁移到 `%APPDATA%/DJI-DPVC/ffmpeg`，并增强目录/文件操作异常处理与提示一致性。
- 支持启动时检查更新：拉取更新信息 JSON 并比较版本号，在有新版本时弹窗提供下载源选择。
- 修复更新检查中 Tk 根窗口初始化时序问题，避免字体初始化失败。
- 询问对话框支持根据文本长度自动适配高度，减少长文本截断问题。

#### 5) 其他改动
- 同步维护主程序版本号与配置版本号，提升历史配置迁移与兼容性。
- 清理冗余模块：移除独立错误转储脚本并整合到主程序，简化部署结构。

### v3.9
1. 修改配置文件架构，解决权限问题。
2. 修复 ffmpeg 异常调用。
3. 添加 NV 加速设置和自动调整 NV 加速开关。

### v3.8
1. 搭建了一套对于普通人更友好的 UI。
2. 添加了对 DJI Goggles 系列眼镜的支持。
3. 加入了 CRF 算法，大幅减小输出文件尺寸。
4. 优化了代码，提高运行效率和资源利用率。
5. 修复了 ffmpeg 无法调用与不随主进程自动退出的 BUG。

---

## 📜 许可说明
本工具仅供学习与研究使用，请遵守相关法律法规。  
